# E2E æµ‹è¯•è¯´æ˜

## âœ… æµ‹è¯•å·²å®Œæˆé…ç½®

E2Eæµ‹è¯•å·²ç»æ­£ç¡®é…ç½®åœ¨ `/e2e` ç›®å½•ä¸­ï¼Œä½¿ç”¨ Playwright æµ‹è¯•æ¡†æ¶ã€‚

## ğŸ“ æµ‹è¯•ç»“æ„

```
e2e/
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ subscription.spec.ts         # è®¢é˜…æƒé™æµ‹è¯•
â”œâ”€â”€ helpers/
â”‚   â””â”€â”€ subscription-helper.ts       # æµ‹è¯•è¾…åŠ©å·¥å…·
â”œâ”€â”€ fixtures/
â”‚   â””â”€â”€ users.ts                     # æµ‹è¯•æ•°æ®
â””â”€â”€ README.md                        # æµ‹è¯•æ–‡æ¡£
```

## ğŸš€ è¿è¡Œæµ‹è¯•

### å‰ç½®è¦æ±‚

1. ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼š
```bash
pnpm dev
```

2. å®‰è£…æµ‹è¯•æµè§ˆå™¨ï¼ˆåªéœ€è¿è¡Œä¸€æ¬¡ï¼‰ï¼š
```bash
pnpm exec playwright install chromium
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm exec playwright test

# è¿è¡Œè®¢é˜…æµ‹è¯•
pnpm exec playwright test e2e/tests/subscription.spec.ts

# å¸¦ç•Œé¢è¿è¡Œï¼ˆè°ƒè¯•ç”¨ï¼‰
pnpm exec playwright test --headed

# åªç”¨Chromeè¿è¡Œ
pnpm exec playwright test --project=chromium

# æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
pnpm exec playwright show-report
```

## âš ï¸ å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 1. CookieåŒæ„å¼¹çª—é—®é¢˜ âœ… å·²è§£å†³
~~æµ‹è¯•ä¸­å¯èƒ½ä¼šé‡åˆ°cookieåŒæ„å¼¹çª—æŒ¡ä½æ“ä½œå…ƒç´ çš„é—®é¢˜ã€‚~~

**è§£å†³æ–¹æ¡ˆå·²å®æ–½ï¼š**
åœ¨æµ‹è¯•ä¸­é€šè¿‡é¢„è®¾cookieæ¥è·³è¿‡åŒæ„å¼¹çª—ï¼š
```typescript
async function loginAs(page: Page, user: typeof mockUsers.freeUser) {
  // è®¾ç½®cookieä»¥è·³è¿‡cookieåŒæ„å¼¹çª—
  await page.context().addCookies([
    {
      name: 'gdpr-consent',
      value: 'true',
      domain: 'localhost',
      path: '/'
    }
  ]);

  await page.goto('/sign-in');
  // ... ç»§ç»­ç™»å½•æµç¨‹
}
```

### 2. æµ‹è¯•ç”¨æˆ·æ•°æ®
æµ‹è¯•éœ€è¦åœ¨æ•°æ®åº“ä¸­é¢„å…ˆåˆ›å»ºæµ‹è¯•ç”¨æˆ·ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š

1. åˆ›å»ºæµ‹è¯•æ•°æ®ç§å­è„šæœ¬
2. ä½¿ç”¨æµ‹è¯•ä¸“ç”¨æ•°æ®åº“
3. åœ¨æµ‹è¯•å‰åæ¸…ç†æ•°æ®

**æ³¨æ„ï¼š** å½“å‰æµ‹è¯•ä¼šåœ¨ç™»å½•å¤±è´¥æ—¶ï¼ˆæµ‹è¯•ç”¨æˆ·ä¸å­˜åœ¨ï¼‰ç›´æ¥å¯¼èˆªåˆ°ç›®æ ‡é¡µé¢ç»§ç»­æµ‹è¯•ã€‚

### 3. ç¯å¢ƒéš”ç¦»
å»ºè®®ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•ç¯å¢ƒï¼š

```env
# .env.test
DATABASE_URL=test.db
NEXT_PUBLIC_APP_URL=http://localhost:3001
```

## ğŸ“‹ æµ‹è¯•è¦†ç›–å†…å®¹

### å½“å‰å®ç°çš„æµ‹è¯•

1. **å…è´¹ç‰ˆæƒé™æµ‹è¯•**
   - æœç´¢æ¬¡æ•°é™åˆ¶æ£€æŸ¥
   - AIè§£è¯»åŠŸèƒ½é™åˆ¶
   - é‡è¡¨æŸ¥çœ‹é™åˆ¶

2. **ä¸“ä¸šç‰ˆæƒé™æµ‹è¯•**
   - æ— é™æœç´¢éªŒè¯
   - AIè§£è¯»è®¿é—®æƒé™

3. **å‡çº§æµç¨‹æµ‹è¯•**
   - é™åˆ¶æç¤ºæ˜¾ç¤º
   - å‡çº§æŒ‰é’®è·³è½¬

## ğŸ”§ æµ‹è¯•æœ€ä½³å®è·µ

1. **æ•°æ®éš”ç¦»**: æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®
2. **æ¸…ç†æœºåˆ¶**: æµ‹è¯•åæ¸…ç†åˆ›å»ºçš„æ•°æ®
3. **ç­‰å¾…ç­–ç•¥**: ä½¿ç”¨Playwrightçš„æ™ºèƒ½ç­‰å¾…è€Œéç¡¬ç¼–ç ç­‰å¾…
4. **æ–­è¨€æ˜ç¡®**: ä½¿ç”¨æ¸…æ™°çš„æœŸæœ›å€¼
5. **é”™è¯¯å¤„ç†**: å¦¥å–„å¤„ç†æµ‹è¯•ä¸­çš„å¼‚å¸¸æƒ…å†µ

## ğŸš¦ CI/CD é›†æˆ

å¯ä»¥åœ¨GitHub Actionsä¸­è¿è¡Œæµ‹è¯•ï¼š

```yaml
name: E2E Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: pnpm install
      - run: pnpm exec playwright install --with-deps
      - run: pnpm dev &
      - run: sleep 5
      - run: pnpm exec playwright test
      - uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
```

## ğŸ“ ä¸‹ä¸€æ­¥æ”¹è¿›

1. **å®Œå–„æµ‹è¯•è¦†ç›–**ï¼šæ·»åŠ æ›´å¤šè¾¹ç•Œæƒ…å†µæµ‹è¯•
2. **Mockæ•°æ®**ï¼šä½¿ç”¨Mock APIé¿å…ä¾èµ–çœŸå®åç«¯
3. **å¹¶è¡ŒåŒ–**ï¼šä¼˜åŒ–æµ‹è¯•æ‰§è¡Œé€Ÿåº¦
4. **æŠ¥å‘Šä¼˜åŒ–**ï¼šé›†æˆæ›´è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š
5. **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šæµ‹è¯•é€šè¿‡åè‡ªåŠ¨éƒ¨ç½²

---

*æ³¨æ„ï¼šæµ‹è¯•ä»£ç ä¸ç”Ÿäº§ä»£ç å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šå½±å“ç”Ÿäº§ç¯å¢ƒã€‚*